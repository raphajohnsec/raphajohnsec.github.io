
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="robots" content="index, follow" />

  <link href="https://fonts.googleapis.com/css2?family=Source+Code+Pro:ital,wght@0,400;0,700;1,400&family=Source+Sans+Pro:ital,wght@0,300;0,400;0,700;1,400&display=swap" rel="stylesheet">

    <link rel="stylesheet" type="text/css" href="/theme/stylesheet/style.min.css">

    <link id="dark-theme-style" rel="stylesheet" type="text/css"
        disabled="disabled"
    href="/theme/stylesheet/dark-theme.min.css">

    <link id="pygments-dark-theme" rel="stylesheet" type="text/css"
            disabled="disabled"
          href="/theme/pygments/monokai.min.css">
    <link id="pygments-light-theme" rel="stylesheet" type="text/css"
          href="/theme/pygments/github.min.css">


  <link rel="stylesheet" type="text/css" href="/theme/font-awesome/css/fontawesome.css">
  <link rel="stylesheet" type="text/css" href="/theme/font-awesome/css/brands.css">
  <link rel="stylesheet" type="text/css" href="/theme/font-awesome/css/solid.css">

  <link rel="stylesheet" type="text/css" href="/static/css/custom.css">

    <link href="/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Security Blog Atom">



  


 

<meta name="author" content="raphajohnsec" />
<meta name="description" content="Click on &#34;Continue Reading&#34; to activate the password field." />
<meta name="keywords" content="#htb, #python, #impacket, #windows, #active-directory, #writeup">


  <meta property="og:site_name" content="Security Blog"/>
  <meta property="og:title" content="HTB - StreamIO - Writeup"/>
  <meta property="og:description" content="Click on &#34;Continue Reading&#34; to activate the password field."/>
  <meta property="og:locale" content="en_US"/>
  <meta property="og:url" content="/drafts/htb-streamio-writeup.html"/>
  <meta property="og:type" content="article"/>
  <meta property="article:published_time" content="2022-06-14 00:00:00+02:00"/>
  <meta property="article:modified_time" content=""/>
  <meta property="article:author" content="/author/raphajohnsec.html">
  <meta property="article:section" content="htb"/>
  <meta property="article:tag" content="#htb"/>
  <meta property="article:tag" content="#python"/>
  <meta property="article:tag" content="#impacket"/>
  <meta property="article:tag" content="#windows"/>
  <meta property="article:tag" content="#active-directory"/>
  <meta property="article:tag" content="#writeup"/>
  <meta property="og:image" content="/images/profile.jpg">

  <title>Security Blog &ndash; HTB - StreamIO - Writeup</title>

</head>
<body class="light-theme">
  <aside>
    <div>
      <a href="/">
        <img src="/images/profile.jpg" alt="Security Blog" title="Security Blog">
      </a>

      <h1>
        <a href="/">Security Blog</a>
      </h1>

<p>Content is my own</p>

      <nav>
        <ul class="list">


              <li>
                <a target="_self"
                   href="/pages/about/">
                  About
                </a>
              </li>

        </ul>
      </nav>

      <ul class="social">
          <li>
            <a  class="sc-twitter" href="https://twitter.com/raphajohnsec" target="_blank">
              <i class="fab fa-twitter"></i>
            </a>
          </li>
      </ul>
    </div>

  </aside>
  <main>

    <nav>
      <a href="/">Home</a>

      <a href="/archives.html">Archives</a>
      <a href="/categories.html">Categories</a>
      <a href="/tags.html">Tags</a>

      <a href="/feeds/all.atom.xml">Atom</a>

    </nav>

<article class="single">
  <header>
      
    <h1 id="htb-streamio-writeup">HTB - StreamIO - Writeup</h1>
    <p>
      Posted on Tue 14 June 2022 in <a href="/category/htb.html">htb</a>

    </p>
  </header>


  <div>
    <p>We have an IP, so we start with the usual, a simple port scan using nmap.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Nmap 7.80 scan initiated Wed Jun 15 08:35:18 2022 as: nmap -p - -T4 -sV -oA nmap_streamio 10.10.11.158</span>
Nmap scan report <span class="k">for</span> streamio <span class="o">(</span><span class="m">10</span>.10.11.158<span class="o">)</span>
Host is up <span class="o">(</span><span class="m">0</span>.026s latency<span class="o">)</span>.
Not shown: <span class="m">65517</span> filtered ports
PORT      STATE SERVICE       VERSION
<span class="m">53</span>/tcp    open  domain?
<span class="m">80</span>/tcp    open  http          Microsoft IIS httpd <span class="m">10</span>.0
<span class="m">88</span>/tcp    open  kerberos-sec  Microsoft Windows Kerberos <span class="o">(</span>server time: <span class="m">2022</span>-06-15 <span class="m">13</span>:14:25Z<span class="o">)</span>
<span class="m">135</span>/tcp   open  msrpc         Microsoft Windows RPC
<span class="m">139</span>/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn
<span class="m">389</span>/tcp   open  ldap          Microsoft Windows Active Directory LDAP <span class="o">(</span>Domain: streamIO.htb0., Site: Default-First-Site-Name<span class="o">)</span>
<span class="m">443</span>/tcp   open  ssl/http      Microsoft HTTPAPI httpd <span class="m">2</span>.0 <span class="o">(</span>SSDP/UPnP<span class="o">)</span>
<span class="m">445</span>/tcp   open  microsoft-ds?
<span class="m">464</span>/tcp   open  kpasswd5?
<span class="m">593</span>/tcp   open  ncacn_http    Microsoft Windows RPC over HTTP <span class="m">1</span>.0
<span class="m">636</span>/tcp   open  tcpwrapped
<span class="m">5985</span>/tcp  open  http          Microsoft HTTPAPI httpd <span class="m">2</span>.0 <span class="o">(</span>SSDP/UPnP<span class="o">)</span>
<span class="m">9389</span>/tcp  open  mc-nmf        .NET Message Framing
<span class="m">49667</span>/tcp open  msrpc         Microsoft Windows RPC
<span class="m">49673</span>/tcp open  ncacn_http    Microsoft Windows RPC over HTTP <span class="m">1</span>.0
<span class="m">49674</span>/tcp open  msrpc         Microsoft Windows RPC
<span class="m">49701</span>/tcp open  msrpc         Microsoft Windows RPC
<span class="m">61653</span>/tcp open  msrpc         Microsoft Windows RPC
<span class="m">1</span> service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :
SF-Port53-TCP:V<span class="o">=</span><span class="m">7</span>.80%I<span class="o">=</span><span class="m">7</span>%D<span class="o">=</span><span class="m">6</span>/15%Time<span class="o">=</span>62A97E0B%P<span class="o">=</span>x86_64-pc-linux-gnu%r<span class="o">(</span>DNSV
SF:ersionBindReqTCP,20,<span class="s2">&quot;\0\x1e\0\x06\x81\x04\0\x01\0\0\0\0\0\0\x07version\</span>
<span class="s2">SF:x04bind\0\0\x10\0\x03&quot;</span><span class="o">)</span><span class="p">;</span>
Service Info: Host: DC<span class="p">;</span> OS: Windows<span class="p">;</span> CPE: cpe:/o:microsoft:windows

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
<span class="c1"># Nmap done at Wed Jun 15 08:39:11 2022 -- 1 IP address (1 host up) scanned in 233.05 seconds</span>
</code></pre></div>

<p>No RDP, but ldap port open and responding with domain information, the host might be an active directory domain controller. Let's see what the http/https ports show.</p>
<div class="highlight"><pre><span></span><code>curl --silent -v http://$TIP
</code></pre></div>

<div class="highlight"><pre><span></span><code>*   Trying 10.10.11.158:80...
* TCP_NODELAY set
* Connected to 10.10.11.158 (10.10.11.158) port 80 (#0)
&gt; GET / HTTP/1.1
&gt; Host: 10.10.11.158
&gt; User-Agent: curl/7.68.0
&gt; Accept: */*
&gt; 
* Mark bundle as not supporting multiuse
<span class="p">&lt;</span> <span class="nt">HTTP</span><span class="err">/</span><span class="na">1</span><span class="err">.</span><span class="na">1</span> <span class="na">200</span> <span class="na">OK</span>
<span class="err">&lt;</span> <span class="na">Content-Type:</span> <span class="na">text</span><span class="err">/</span><span class="na">html</span>
<span class="err">&lt;</span> <span class="na">Last-Modified:</span> <span class="na">Tue</span><span class="err">,</span> <span class="na">22</span> <span class="na">Feb</span> <span class="na">2022</span> <span class="na">10:46:01</span> <span class="na">GMT</span>
<span class="err">&lt;</span> <span class="na">Accept-Ranges:</span> <span class="na">bytes</span>
<span class="err">&lt;</span> <span class="na">ETag:</span> <span class="err">&quot;</span><span class="na">b23de861d927d81:0</span><span class="err">&quot;</span>
<span class="err">&lt;</span> <span class="na">Server:</span> <span class="na">Microsoft-IIS</span><span class="err">/</span><span class="na">10</span><span class="err">.</span><span class="na">0</span>
<span class="err">&lt;</span> <span class="na">X-Powered-By:</span> <span class="na">ASP</span><span class="err">.</span><span class="na">NET</span>
<span class="err">&lt;</span> <span class="na">Date:</span> <span class="na">Wed</span><span class="err">,</span> <span class="na">15</span> <span class="na">Jun</span> <span class="na">2022</span> <span class="na">13:24:29</span> <span class="na">GMT</span>
<span class="err">&lt;</span> <span class="na">Content-Length:</span> <span class="na">703</span>
<span class="err">&lt;</span> 
<span class="err">{</span> <span class="err">[</span><span class="na">703</span> <span class="na">bytes</span> <span class="na">data</span><span class="err">]</span>
<span class="err">*</span> <span class="na">Connection</span> <span class="err">#</span><span class="na">0</span> <span class="na">to</span> <span class="na">host</span> <span class="na">10</span><span class="err">.</span><span class="na">10</span><span class="err">.</span><span class="na">11</span><span class="err">.</span><span class="na">158</span> <span class="na">left</span> <span class="na">intact</span>
<span class="err">&lt;!</span><span class="na">DOCTYPE</span> <span class="na">html</span> <span class="na">PUBLIC</span> <span class="err">&quot;</span><span class="na">-</span><span class="err">//</span><span class="na">W3C</span><span class="err">//</span><span class="na">DTD</span> <span class="na">XHTML</span> <span class="na">1</span><span class="err">.</span><span class="na">0</span> <span class="na">Strict</span><span class="err">//</span><span class="na">EN</span><span class="err">&quot;</span> <span class="err">&quot;</span><span class="na">http:</span><span class="err">//</span><span class="na">www</span><span class="err">.</span><span class="na">w3</span><span class="err">.</span><span class="na">org</span><span class="err">/</span><span class="na">TR</span><span class="err">/</span><span class="na">xhtml1</span><span class="err">/</span><span class="na">DTD</span><span class="err">/</span><span class="na">xhtml1-strict</span><span class="err">.</span><span class="na">dtd</span><span class="err">&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span> <span class="na">xmlns</span><span class="o">=</span><span class="s">&quot;http://www.w3.org/1999/xhtml&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">meta</span> <span class="na">http-equiv</span><span class="o">=</span><span class="s">&quot;Content-Type&quot;</span> <span class="na">content</span><span class="o">=</span><span class="s">&quot;text/html; charset=iso-8859-1&quot;</span> <span class="p">/&gt;</span>
<span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>IIS Windows Server<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">style</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text/css&quot;</span><span class="p">&gt;</span><span class="w"></span>
<span class="o">&lt;!</span><span class="nt">--</span><span class="w"></span>
<span class="nt">body</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">color</span><span class="p">:</span><span class="mh">#000000</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">background-color</span><span class="p">:</span><span class="mh">#0072C6</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">margin</span><span class="p">:</span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="p">#</span><span class="nn">container</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">margin-left</span><span class="p">:</span><span class="kc">auto</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">margin-right</span><span class="p">:</span><span class="kc">auto</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">text-align</span><span class="p">:</span><span class="kc">center</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="nt">a</span><span class="w"> </span><span class="nt">img</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">border</span><span class="p">:</span><span class="kc">none</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="nt">--</span><span class="o">&gt;</span><span class="w"></span>
<span class="p">&lt;/</span><span class="nt">style</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;container&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;http://go.microsoft.com/fwlink/?linkid=66138&amp;amp;clcid=0x409&quot;</span><span class="p">&gt;&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;iisstart.png&quot;</span> <span class="na">alt</span><span class="o">=</span><span class="s">&quot;IIS&quot;</span> <span class="na">width</span><span class="o">=</span><span class="s">&quot;960&quot;</span> <span class="na">height</span><span class="o">=</span><span class="s">&quot;600&quot;</span> <span class="p">/&gt;&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</code></pre></div>

<p>Standard IIS site..., https responds with a 404...
Maybe <a href="https://github.com/projectdiscovery/nuclei#install-nuclei">nuclei</a> can find more information.
<img alt="Nuclei http" src="/images/htb/streamio/htb_streamio_nuclei_http.PNG">
Not for http.. Nothing intersting, but https leads to more information
<img alt="Nuclei https" src="/images/htb/streamio/htb_streamio_nuclei_https.PNG">
You can see, nuclei found two DNS names inside the SSL certificate:
- <strong>streamIO.htb</strong>
- <strong>watch.streamIO.htb</strong></p>
<p>Maybe the webserver responds differently whem we talk to the domain instead of the IP.
We specify the hostnames in <code>/etc/hosts</code>. If we ran our own DNS resolver, we could also specify the addresses there.
Include this</p>
<div class="highlight"><pre><span></span><code><span class="mf">10.10.11.158</span><span class="w">    </span><span class="n">streamio</span><span class="w"> </span><span class="n">streamIO</span><span class="mf">.</span><span class="n">htb0</span><span class="w"> </span><span class="n">watch</span><span class="mf">.</span><span class="n">streamIO</span><span class="mf">.</span><span class="n">htb</span><span class="w"> </span><span class="n">streamio</span><span class="mf">.</span><span class="n">htb</span><span class="w"></span>
</code></pre></div>

<p>The http response is still the same when requesting <code>http://streamio.htb</code>, but <code>https://streamio.htb</code> now responds with a "real" website.
<img alt="streamio https site" src="/images/htb/streamio/htb_streamio_https_site.PNG">
Also <code>https://watch.streamio.htb</code> reveals a website.
<img alt="streamio https site" src="/images/htb/streamio/htb_streamio_watch_https_site.PNG"></p>
<p>Nuclei couln't find any vulnerabilities for both websites. Time to crawl both sites.
feroxbuster found some available endpoints on <code>https://streamio.htb</code></p>
<div class="highlight"><pre><span></span><code>./feroxbuster -k -u https://streamio.htb/ -x php,html,txt -w directory-list-lowercase-2.3-small.txt -t <span class="m">100</span> -o feroxbuster_streamio.htb.log

<span class="m">200</span>      GET      395l      915w    13497c https://streamio.htb/
<span class="m">301</span>      GET        2l       10w      151c https://streamio.htb/images <span class="o">=</span>&gt; https://streamio.htb/images/
<span class="hll"><span class="m">200</span>      GET      121l      291w     4500c https://streamio.htb/register.php
</span><span class="hll"><span class="m">200</span>      GET      206l      430w     6434c https://streamio.htb/contact.php
</span><span class="hll"><span class="m">200</span>      GET      395l      915w    13497c https://streamio.htb/index.php
</span><span class="hll"><span class="m">200</span>      GET      231l      571w     7825c https://streamio.htb/about.php
</span><span class="hll"><span class="m">200</span>      GET      111l      269w     4145c https://streamio.htb/login.php
</span><span class="hll"><span class="m">301</span>      GET        2l       10w      150c https://streamio.htb/admin <span class="o">=</span>&gt; https://streamio.htb/admin/
</span><span class="m">301</span>      GET        2l       10w      157c https://streamio.htb/admin/images <span class="o">=</span>&gt; https://streamio.htb/admin/images/
<span class="m">403</span>      GET        1l        1w       18c https://streamio.htb/admin/index.php
<span class="m">301</span>      GET        2l       10w      148c https://streamio.htb/css <span class="o">=</span>&gt; https://streamio.htb/css/
<span class="m">301</span>      GET        2l       10w      154c https://streamio.htb/admin/css <span class="o">=</span>&gt; https://streamio.htb/admin/css/
<span class="m">301</span>      GET        2l       10w      147c https://streamio.htb/js <span class="o">=</span>&gt; https://streamio.htb/js/
<span class="m">301</span>      GET        2l       10w      153c https://streamio.htb/admin/js <span class="o">=</span>&gt; https://streamio.htb/admin/js/
<span class="m">302</span>      GET        0l        0w        0c https://streamio.htb/logout.php <span class="o">=</span>&gt; https://streamio.htb/
<span class="m">301</span>      GET        2l       10w      150c https://streamio.htb/fonts <span class="o">=</span>&gt; https://streamio.htb/fonts/
<span class="hll"><span class="m">200</span>      GET        2l        6w       58c https://streamio.htb/admin/master.php
</span><span class="m">301</span>      GET        2l       10w      156c https://streamio.htb/admin/fonts <span class="o">=</span>&gt; https://streamio.htb/admin/fonts/
</code></pre></div>

<p>While trying to analyse <code>https://watch.streamio.htb</code>, feroxbuster and nuclei threw an error or didn't output any results. I thought at first, that the entry in <code>/etc/hosts</code> were wrong, but the entries were correct. I could't fingure why streamio.htb resolved correctly but watch.streamio.htb didn't. To resolve this I had to set up my own DNS resolver as suggested earlier in this article.
Because I use Ubuntu 20.04 as my pwnbox, I can install dnscrypt-proxy from the repository, it's up to date enough.</p>
<div class="highlight"><pre><span></span><code>apt install dnscrypt-proxy
</code></pre></div>

<p>You don't even have to disable existing name server/resolver on the system. dnscrypt-proxy listens by default and the address 127.0.2.1.
I edit the default config slightly, I add the following content just after <code>server_names = ['cloudflare']</code> in <code>/etc/dnscrypt-proxy/dnscrypt-proxy.toml</code>.</p>
<div class="highlight"><pre><span></span><code>cloaking_rules = &#39;cloaking_rules.txt&#39;
</code></pre></div>

<p>We add the file <code>/etc/dnscrypt-proxy/cloaking_rules.txt</code> with the content</p>
<div class="highlight"><pre><span></span><code>*.streamio.htb  10.10.11.158
</code></pre></div>

<p>and to <code>/etc/resolv.conf</code> we add <code>nameserver    127.0.2..1</code> as first nameserver entry.</p>
  </div>
  <div class="tag-cloud">
    <p>
      <a href="/tag/htb.html">#htb</a>
      <a href="/tag/python.html">#python</a>
      <a href="/tag/impacket.html">#impacket</a>
      <a href="/tag/windows.html">#windows</a>
      <a href="/tag/active-directory.html">#active-directory</a>
      <a href="/tag/writeup.html">#writeup</a>
    </p>
  </div>





</article>

    <footer>
<p>&copy; 2022 </p>
<p>
Built with <a href="http://getpelican.com" target="_blank">Pelican</a> using <a href="http://bit.ly/flex-pelican" target="_blank">Flex</a> theme
  <span class="footer-separator">|</span>
  Switch to the <a href="javascript:void(0)" onclick="theme.switch(`dark`)">dark</a> | <a href="javascript:void(0)" onclick="theme.switch(`light`)">light</a> | <a href="javascript:void(0)" onclick="theme.switch(`browser`)">browser</a> theme
  <script id="dark-theme-script"
          src="/theme/dark-theme/dark-theme.min.js"
          data-enable-auto-detect-theme="False"
          data-default-theme="light"
          type="text/javascript">
  </script>
</p>    </footer>
  </main>




<script type="application/ld+json">
{
  "@context" : "http://schema.org",
  "@type" : "Blog",
  "name": " Security Blog ",
  "url" : "",
  "image": "/images/profile.jpg",
  "description": ""
}
</script>

</body>
</html>